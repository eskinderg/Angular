@if (movie) {
    <div class="movie-detail">
        <div
            class="backdrop-banner"
            [ngStyle]="{ 'background-image': movie.get_back_drop_image_url() || 'none' }">
            <div class="banner-overlay"></div>

            <div class="banner-top">
                <button class="back-btn" (click)="goBack()">← Back</button>
            </div>

            <div class="banner-content">
                <h1 class="banner-title">{{ movie.title || movie.name || movie.original_title }}</h1>
                <div class="banner-sub">
                    @if (movie.release_date) {
                        <span>{{ movie.release_date | date: 'yyyy' }}</span>
                    }
                    @if (movie.runtime) {
                        <span>• {{ movie.runtime }} min</span>
                    }
                    @if (movie.status) {
                        <span>• {{ movie.status }}</span>
                    }
                </div>
            </div>
        </div>

        <div class="container">
            @if (movie.get_poster_path_w500()) {
                <aside class="poster-card">
                    <img
                        [src]="movie.get_poster_path_w500()"
                        [alt]="movie.title || movie.name"
                        class="poster"
                        loading="lazy" />
                    @if (movie.homepage) {
                        <a
                            [href]="movie.homepage"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="visit-btn">
                            Visit official site
                        </a>
                    }
                </aside>
            } @else {
                <aside class="poster-card poster-placeholder">
                    <div class="poster-fallback">No poster</div>
                </aside>
            }

            <section class="info">
                <header class="info-header">
                    <h2 class="title">Details</h2>
                </header>

                <div class="rating-row">
                    <div class="rating">
                        <div class="score">{{ movie.vote_average?.toFixed(1) || '—' }}</div>
                        <div class="votes">{{ movie.vote_count || 0 }} votes</div>
                    </div>

                    @if (movie.popularity) {
                        <div class="popularity">
                            Popularity: <strong>{{ movie.popularity }}</strong>
                        </div>
                    }

                    @if (movie.original_language) {
                        <div class="language">
                            Lang: <strong>{{ movie.original_language | uppercase }}</strong>
                        </div>
                    }
                </div>

                @if (movie.genres?.length) {
                    <div class="genres">
                        @for (g of movie.genres; track g) {
                            <span class="genre">{{ g['name'] }}</span>
                        }
                    </div>
                }

                @if (movie.overview) {
                    <article class="overview">
                        <h3>Overview</h3>
                        <p>{{ movie.overview }}</p>
                    </article>
                }

                <div class="extra-grid">
                    <div class="left">
                        <dl class="meta-list">
                            @if (movie.original_title) {
                                <div class="meta-item">
                                    <dt>Original title</dt>
                                    <dd>{{ movie.original_title }}</dd>
                                </div>
                            }

                            @if (movie.release_date) {
                                <div class="meta-item">
                                    <dt>Release date</dt>
                                    <dd>{{ movie.release_date | date: 'longDate' }}</dd>
                                </div>
                            }

                            @if (movie.runtime) {
                                <div class="meta-item">
                                    <dt>Runtime</dt>
                                    <dd>{{ movie.runtime }} minutes</dd>
                                </div>
                            }

                            @if (movie.homepage) {
                                <div class="meta-item">
                                    <dt>Homepage</dt>
                                    <dd>
                                        <a
                                            [href]="movie.homepage"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            >{{ movie.homepage }}</a
                                        >
                                    </dd>
                                </div>
                            }
                        </dl>
                    </div>

                    <div class="right">
                        @if (movie.casts?.length) {
                            <div class="casts">
                                <h4>Top cast</h4>
                                <ul class="cast-list">
                                    @for (c of movie.casts | slice: 0 : 8; track c) {
                                        <li>{{ c }}</li>
                                    }
                                </ul>
                            </div>
                        }
                    </div>
                </div>

                @if (movie.reviews) {
                    <section class="reviews">
                        <h4>Reviews</h4>
                        @if (movie.reviews.results?.length) {
                            <div class="reviews-list">
                                @for (r of movie.reviews.results | slice: 0 : 5; track r) {
                                    <article class="review">
                                        <div class="review-head">
                                            <strong class="author">{{ r['author'] }}</strong>
                                            <span class="created">{{
                                                r['created_at'] | date: 'mediumDate'
                                            }}</span>
                                        </div>
                                        <p class="review-body">
                                            {{ r['content'] | slice: 0 : 400 }}
                                            @if (r['content'].length > 400) {
                                                <span>…</span>
                                            }
                                        </p>
                                        @if (r['url']) {
                                            <a
                                                class="read-more"
                                                [href]="r['url']"
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                >Read full</a
                                            >
                                        }
                                    </article>
                                }
                            </div>
                        } @else {
                            <p class="muted">No reviews available.</p>
                        }
                    </section>
                }
            </section>
        </div>
    </div>
}
